extends layout

block content
  .container
    h1= title

    .upload-section
      button#show-upload-form.btn-secondary ðŸ“¤ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²

      form#upload-form.upload-form.hidden(action='/upload' method='POST' enctype='multipart/form-data')
        .file-upload-wrapper
          input#file-input(type='file' name='logfile' accept='.log,.txt' required)
          label.file-label(for='file-input')
        button.btn-upload(type='submit') Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ

    script.
      document.getElementById('show-upload-form').addEventListener('click', () => {
        document.getElementById('upload-form').classList.toggle('hidden');
      });

      const fileInput = document.getElementById('file-input');
      fileInput.addEventListener('change', (e) => {
        if (e.target.files[0]) {
          document.getElementById('file-name').textContent = e.target.files[0].name;
        }
      });

    if !recipients.list || recipients.list.length === 0
      .empty-state
        .empty-icon ðŸ“­
        h2 Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚
        p Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ð» Ð»Ð¾Ð³Ð¾Ð² Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹

        .data-hint
          ol.hint-steps
            li ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "ðŸ“¤ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²"
            li Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ð» 
              code sample-data/sample.log
              |  Ð¸Ð· Ð¿Ð°Ð¿ÐºÐ¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
            li ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ"

          p.hint-note
            strong ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: 
            | Ð¤Ð°Ð¹Ð» 
            code sample.log
            |  ÑƒÐ¶Ðµ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² Ð¿Ð°Ð¿ÐºÐµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¿Ð¾ÑÐ»Ðµ ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ
    else
      div.stats-summary
        div.stat-card
          div.stat-number= numbers.recipientsNumber
          div.stat-label ÐŸÐ¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¹
        div.stat-card
          div.stat-number= numbers.logsNumber
          div.stat-label Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
        a.stat-card.stat-card-link(href="/logs/stats")
          span ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ Ð´Ð¾Ð¼ÐµÐ½Ð°Ð¼

      div.recipients
        div
          h2 ÐŸÐ¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»Ð¸
          p.recipients-info= recipients.limit > 0 ? `ÐŸÐ¾ÐºÐ°Ð·Ð°Ð½Ñ‹ Ñ‚Ð¾Ð¿-${recipients.limit} Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¿Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹` : ''

      div.search-controls
        div.search-box
          label.search-label(for="search") Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ
          input#search.search-input(type="text", placeholder="ðŸ” ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ email...")

        div.direct-search-box.relative
          label.search-label(for="address-input") ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ
          #address-error âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ email
          form#address-form.direct-search-form(action="/logs", method="GET")
            input#address-input.search-input(type="text", name="address", placeholder="âœ‰ï¸ Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ email Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»Ñ", required)
            button.btn-search(type="submit") ÐÐ°Ð¹Ñ‚Ð¸


      div.recipients-grid
        each recipient in recipients.list
          a.recipient-card(href=`/logs/${encodeURIComponent(recipient.address)}`)
            .recipient-email= recipient.address
            .recipient-count
              span.badge= recipient.count
              |  ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹

    script.
      document.getElementById('search').addEventListener('input', (e) => {
        const filter = e.target.value.toLowerCase();
        document.querySelectorAll('.recipient-card').forEach(card => {
          const email = card.querySelector('.recipient-email').textContent.toLowerCase();
          card.style.display = email.includes(filter) ? 'block' : 'none';
        });
      });

      document.getElementById('address-form').addEventListener('submit', function(e) {
        const emailInput = document.getElementById('address-input');
        const email = emailInput.value.trim();
        const emailRegex = /^[\w.%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

        if (!emailRegex.test(email)) {
          e.preventDefault();
          const errorDiv = document.getElementById('address-error');
          if (errorDiv) {
            errorDiv.textContent = 'âŒ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ email';
            errorDiv.style.display = 'block';
            emailInput.focus();

            setTimeout(() => {
              errorDiv.style.display = 'none';
            }, 3000);
          }
        }
      });
